{# templates/student/transcript_full.html #}
{% extends "student/base_student.html" %}

{% block title %}Full Academic Transcript - {{ transcript.student_name if transcript else 'Student Portal' }}{% endblock %}

{% block content %}
<div class="container mt-1">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">Full Academic Transcript</h1>
            
            {% if message %}
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% elif transcript %}
                <!-- Student Header -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h4>{{ transcript.student_name }}</h4>
                        <p class="text-muted mb-0">Student ID: {{ transcript.student_id }}</p>
                    </div>
                </div>
                
                <!-- Cumulative Statistics -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="card-title text-muted">Cumulative GPA</h6>
                                <p class="display-6 fw-bold">{{ "%.2f"|format(transcript.cumulative_gpa) }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="card-title text-muted">Weighted GPA</h6>
                                <p class="display-6 fw-bold">{{ "%.2f"|format(transcript.cumulative_weighted_gpa) }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="card-title text-muted">Credits Attempted</h6>
                                <p class="display-6 fw-bold">{{ transcript.total_credit_hours_attempted }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="card-title text-muted">Credits Earned</h6>
                                <p class="display-6 fw-bold">{{ transcript.total_credit_hours_earned }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Semester-by-Semester Summary Table -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Semester Summary</h5>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Academic Year</th>
                                    <th>Semester</th>
                                    <th class="text-center">Courses</th>
                                    <th class="text-center">GPA</th>
                                    <th class="text-center">Weighted GPA</th>
                                    <th class="text-center">Credit Hours</th>
                                    <th class="text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for summary in transcript.semesters_summary %}
                                <tr>
                                    <td><strong>{{ summary.academic_year|start_year }}</strong></td>
                                    <td>Semester {{ summary.semester }}</td>
                                    <td class="text-center">{{ summary.courses_count }}</td>
                                    <td class="text-center">{{ "%.2f"|format(summary.gpa) }}</td>
                                    <td class="text-center">{{ "%.2f"|format(summary.weighted_gpa) }}</td>
                                    <td class="text-center">{{ summary.credit_hours }}</td>
                                    <td class="text-center">
                                        <a href="{{ url_for('student_transcript.semester_specific', academic_year=summary.academic_year, semester=summary.semester) }}" 
                                           class="btn btn-sm btn-outline-primary">
                                            View
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Detailed Semester Sections -->
                {% for (year, sem), semester_data in transcript.all_semesters.items() %}
                <div class="card mb-4">
                    <div class="card-header {% if semester_data.is_released %}bg-success text-white{% else %}bg-warning text-dark{% endif %}">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{{ year }} - Semester {{ sem }}</h5>
                            <small>
                                {% if semester_data.is_released %}
                                    <span class="badge bg-light text-success">Released</span>
                                {% else %}
                                    <span class="badge bg-light text-warning">Not Released</span>
                                {% endif %}
                            </small>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-sm mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Course Code</th>
                                    <th>Course Name</th>
                                    <th class="text-center">Credits</th>
                                    <th class="text-center">Score</th>
                                    <th class="text-center">Grade</th>
                                    <th class="text-center">Weights</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for course in semester_data.courses %}
                                <tr>
                                    <td><strong>{{ course.course_code }}</strong></td>
                                    <td>{{ course.course_name }}</td>
                                    <td class="text-center">{{ course.credit_hours }}</td>
                                    <td class="text-center">{{ "%.2f"|format(course.final_score) }}</td>
                                    <td class="text-center">
                                        <span class="badge {% if course.grade_letter in ['A', 'B'] %}bg-success{% elif course.grade_letter == 'C' %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ course.grade_letter or 'N/A' }}
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <small class="text-muted" title="Quiz: {{ course.quiz_weight }}% | Assignment: {{ course.assignment_weight }}% | Exam: {{ course.exam_weight }}%">
                                            Q{{ course.quiz_weight|int }}% A{{ course.assignment_weight|int }}% E{{ course.exam_weight|int }}%
                                        </small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer text-muted">
                        <small><strong>GPA:</strong> {{ "%.2f"|format(semester_data.gpa) }}</small>
                    </div>
                </div>
                {% endfor %}
                
                <!-- Download Options -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Actions</h5>
                    </div>
                    <div class="card-body">
                        <a href="{{ url_for('student_transcript.download_full') }}" 
                           class="btn btn-primary">
                            <i class="fas fa-download"></i> Download Full Transcript
                        </a>
                        <a href="{{ url_for('student_transcript.current_semester') }}" 
                           class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Current Semester
                        </a>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-warning">
                    <p>No transcript data available yet. Please check back after your first semester results are released.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .card {
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }
    
    .table-hover tbody tr:hover {
        background-color: #f5f5f5;
    }
    
    .badge {
        font-size: 0.85rem;
        padding: 0.4rem 0.65rem;
    }
    
    .display-6 {
        font-size: 2rem;
    }
</style>
{% endblock %}
