{# templates/student/transcript_current.html #}
{% extends "student/base_student.html" %}

{% block title %}Current Semester Transcript - {{ student_name if transcript else 'Student Portal' }}{% endblock %}

{% block content %}
<div class="container mt-1">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">Current Semester Transcript</h1>
            
            <!-- Transcript Navigation -->
            <div class="card mb-4 border-0 shadow-sm">
                <div class="card-body d-flex flex-wrap gap-2">

                <a href="{{ url_for('student_transcript.current_semester') }}"
                    class="btn {% if request.endpoint == 'student_transcript.current_semester' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    <i class="fas fa-file-alt"></i> Current Semester
                </a>

                {% if transcript %}
                <a href="{{ url_for('student_transcript.semester_specific', academic_year=transcript.academic_year, semester=transcript.semester) }}"
   class="btn btn-outline-dark">
   <i class="fas fa-search"></i> Detailed Semester View
</a>
                {% endif %}

                <a href="{{ url_for('student_transcript.full_transcript') }}"
                    class="btn {% if request.endpoint == 'student_transcript.full_transcript' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    <i class="fas fa-book-open"></i> Academic History
                </a>
<a href="{{ url_for('student_transcript.current_semester') }}" class="btn btn-light mb-3">
  ‚Üê Back to Current Semester
</a>

                {% if transcript %}
                    <a href="{{ url_for('student_transcript.download_full') }}"
                        class="btn btn-outline-success">
                        <i class="fas fa-download"></i> Download Full
                    </a>
                {% endif %}
            </div>
            
            {% if message %}
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% elif transcript %}
                <!-- Transcript Header -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Student ID:</strong> {{ transcript.student_id }}</p>
                                <p><strong>Name:</strong> {{ transcript.student_name }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Academic Year:</strong> {{ transcript.academic_year|start_year }}</p>
                                <p><strong>Semester:</strong> {{ transcript.semester }}</p>
                            </div>
                        </div>
                        
                        <!-- Release Status Badge -->
                        {% if transcript.is_released %}
                            <span class="badge bg-success mt-3">Results Released</span>
                        {% else %}
                            <span class="badge bg-warning mt-3">Results Not Yet Released</span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- GPA Summary -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">GPA</h5>
                                <p class="display-5">{{ "%.2f"|format(transcript.semester_gpa) }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Weighted GPA</h5>
                                <p class="display-5">{{ "%.2f"|format(transcript.semester_weighted_gpa) }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Credit Hours</h5>
                                <p class="display-5">{{ transcript.total_credit_hours }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Courses Table -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Course Results</h5>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Course Code</th>
                                    <th>Course Name</th>
                                    <th>Credit Hours</th>
                                    <th class="text-center">Final Score</th>
                                    <th class="text-center">Grade</th>
                                    <th class="text-center">Weights</th>
                                    <th class="text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for course in transcript.courses %}
                                <tr>
                                    <td>
                                        <strong>{{ course.course_code }}</strong>
                                    </td>
                                    <td>{{ course.course_name }}</td>
                                    <td class="text-center">{{ course.credit_hours }}</td>
                                    <td class="text-center">{{ "%.2f"|format(course.final_score) }}</td>
                                    <td class="text-center">
                                        <span class="badge {% if course.grade_letter in ['A', 'B'] %}bg-success{% elif course.grade_letter == 'C' %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ course.grade_letter or 'N/A' }}
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <small class="text-muted" title="Quiz: {{ course.quiz_weight }}% | Assignment: {{ course.assignment_weight }}% | Exam: {{ course.exam_weight }}%">
                                            Q{{ course.quiz_weight|int }}% A{{ course.assignment_weight|int }}% E{{ course.exam_weight|int }}%
                                        </small>
                                    </td>
                                    <td class="text-center">
                                        {% if course.grade_letter in ['A', 'B', 'C', 'D'] %}
                                            <span class="badge bg-success">Pass</span>
                                        {% elif course.grade_letter == 'F' %}
                                            <span class="badge bg-danger">Fail</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Pending</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Score Breakdown -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Score Breakdown (How Your Grade Was Calculated)</h5>
                    </div>
                    <div class="card-body">
                        {% set total_courses = transcript.courses|length %}
                        {% if total_courses > 0 %}
                            <p>Your final grades are calculated by combining three assessment types:</p>
                            <ul>
                                <li><strong>Quizzes:</strong> Regular assessments to check understanding</li>
                                <li><strong>Assignments:</strong> Practical exercises and projects</li>
                                <li><strong>Exams:</strong> Major assessments covering course content</li>
                            </ul>
                            <p>Each course has a specific weight for these assessments (e.g., 20% quizzes, 30% assignments, 50% exam).</p>
                        {% else %}
                            <p>No courses found for this semester.</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Download Options -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Actions</h5>
                    </div>
                    <div class="card-body">
                        <a href="{{ url_for('student_transcript.download_semester', academic_year=transcript.academic_year, semester=transcript.semester) }}" 
                           class="btn btn-primary">
                            <i class="fas fa-download"></i> Download This Transcript
                        </a>
                        <a href="{{ url_for('student_transcript.full_transcript') }}" 
                           class="btn btn-secondary">
                            <i class="fas fa-book"></i> View Full Academic History
                        </a>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-warning">
                    <p>No transcript data available. Please check back later.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .card {
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .table-hover tbody tr:hover {
        background-color: #f5f5f5;
    }
    
    .badge {
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
    }
</style>
{% endblock %}
