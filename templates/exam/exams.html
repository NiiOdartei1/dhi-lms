{% extends 'exam/base_exam.html' %}
{% block title %}My Exams{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="mb-4">
    <h2 class="mb-1"><i class="fas fa-file-contract"></i> My Exams</h2>
    <p class="text-muted">Manage and take your scheduled exams</p>
  </div>

  {% if exams %}
    <!-- Filter/Status Summary -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card text-center border-0 shadow-sm">
          <div class="card-body">
            <h5 class="text-primary">{{ exams|length }}</h5>
            <p class="text-muted small">Total Exams</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center border-0 shadow-sm">
          <div class="card-body">
            <h5 class="text-success">{{ exams|selectattr('status', 'equalto', 'Ongoing')|list|length }}</h5>
            <p class="text-muted small">Available Now</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center border-0 shadow-sm">
          <div class="card-body">
            <h5 class="text-warning">{{ exams|selectattr('status', 'equalto', 'Upcoming')|list|length }}</h5>
            <p class="text-muted small">Upcoming</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center border-0 shadow-sm">
          <div class="card-body">
            <h5 class="text-secondary">{{ exams|selectattr('status', 'equalto', 'Completed')|list|length }}</h5>
            <p class="text-muted small">Completed</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Exams Table -->
    <div class="card shadow-lg border-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead style="background: linear-gradient(90deg, #4e73df, #1cc88a);" class="text-white">
            <tr>
              <th><i class="fas fa-book-open"></i> Exam Title</th>
              <th><i class="fas fa-graduation-cap"></i> Programme</th>
              <th><i class="fas fa-layer-group"></i> Level</th>
              <th><i class="fas fa-bookmark"></i> Course</th>
              <th><i class="fas fa-calendar"></i> Date & Time</th>
              <th><i class="fas fa-hourglass-half"></i> Duration</th>
              <th><i class="fas fa-info-circle"></i> Status</th>
              <th><i class="fas fa-arrow-right"></i> Action</th>
            </tr>
          </thead>
          <tbody>
            {% for exam in exams %}
            <tr class="align-middle">
              <td>
                <strong>{{ exam.title }}</strong>
              </td>
              <td>
                <span class="badge bg-primary">{{ exam.programme_name }}</span>
              </td>
              <td>
                <span class="badge bg-info">{{ exam.programme_level }}</span>
              </td>
              <td>
                <small class="text-muted">
                  {{ exam.course.code }}<br>
                  <strong>{{ exam.course.name }}</strong>
                </small>
              </td>
              <td>
                <small>
                  <strong>{{ exam.start_datetime.strftime("%b %d, %Y") }}</strong><br>
                  <span class="text-muted">{{ exam.start_datetime.strftime("%H:%M") }} â€” {{ exam.end_datetime.strftime("%H:%M") }}</span>
                </small>
              </td>
              <td>
                <span class="badge bg-secondary">
                  {% if exam.duration_minutes >= 60 %}
                    {{ (exam.duration_minutes / 60)|int }}h {{ exam.duration_minutes % 60 }}m
                  {% else %}
                    {{ exam.duration_minutes }}m
                  {% endif %}
                </span>
              </td>
              <td>
                {% if exam.status == 'Ongoing' %}
                  <span class="badge bg-success"><i class="fas fa-check-circle"></i> Ongoing</span>
                {% elif exam.status == 'Upcoming' %}
                  <span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> Upcoming</span>
                {% elif exam.status == 'Completed' %}
                  <span class="badge bg-secondary"><i class="fas fa-check-double"></i> Completed</span>
                {% else %}
                  <span class="badge bg-danger"><i class="fas fa-times-circle"></i> {{ exam.status }}</span>
                {% endif %}
              </td>
              <td>
                {% if exam.status == 'Ongoing' %}
                  {% if exam.assignment_mode == 'choice' %}
                    <a href="{{ url_for('exam.select_exam_set', exam_id=exam.id) }}" class="btn btn-sm btn-primary" title="Choose your exam set">
                      <i class="fas fa-hand-pointer"></i> Choose Set
                    </a>
                  {% else %}
                    <a href="{{ url_for('exam.exam_instructions', exam_id=exam.id) }}" class="btn btn-sm btn-success" title="Start this exam">
                      <i class="fas fa-play-circle"></i> Start
                    </a>
                  {% endif %}
                {% elif exam.status == 'Upcoming' %}
                  <button class="btn btn-sm btn-outline-secondary" disabled title="Exam not yet available">
                    <i class="fas fa-lock"></i> Locked
                  </button>
                {% else %}
                  <button class="btn btn-sm btn-outline-secondary" disabled title="This exam is no longer available">
                    <i class="fas fa-ban"></i> Unavailable
                  </button>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Help Text -->
    <div class="alert alert-info mt-4" role="alert">
      <i class="fas fa-lightbulb"></i> <strong>Need help?</strong> 
      Only exams with "Ongoing" status are available to take. Contact your programme coordinator if you have questions about exam scheduling.
    </div>

  {% else %}
    <!-- Empty State -->
    <div class="card border-0 shadow-lg">
      <div class="card-body text-center py-5">
        <div style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;">
          <i class="fas fa-inbox"></i>
        </div>
        <h5 class="text-muted">No Exams Scheduled</h5>
        <p class="text-muted">You currently have no exams. Check back later or contact your programme coordinator.</p>
      </div>
    </div>
  {% endif %}
</div>

<!-- Responsive Adjustments -->
<style>
  @media (max-width: 768px) {
    .table-responsive {
      font-size: 0.85rem;
    }
    .badge {
      font-size: 0.7rem;
    }
    .btn-sm {
      padding: 0.35rem 0.5rem;
      font-size: 0.75rem;
    }
  }
</style>

{% endblock %}